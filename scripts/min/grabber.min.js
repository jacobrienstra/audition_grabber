chrome.storage.sync.get(function(t){try{var e=t.sections,n=document.getElementsByTagName("h2"),o=[],a={},i=null,r="",l=(n=[...n]).shift(),s=l.textContent.trim()+" ";s+=nextUntil(l,"h2","br").map(t=>t.textContent.trim()).join(" ");for(const[t,l]of n.entries()){let s=l.firstChild.textContent;switch(l.previousSibling&&3===l.previousSibling.nodeType&&"\n"!=l.previousSibling.textContent&&l.nextSibling&&3===l.nextSibling.nodeType&&"\n"!=l.nextSibling.textContent&&(s=l.previousSibling.textContent.trim()+l.textContent.trim()+l.nextSibling.textContent.trim()),s){case"AUDITION DATE":case"AUDITION DATES":let m=nextUntil(l,"h2","BR");0===m.length&&(m=nextUntil(l.firstChild,"","BR"));let x="";for(let[t,e]of[...m].entries())if(e=e.textContent.trim(),moment(e,"ddd, MMM D, YYYY").isValid())o.length>0&&(o[o.length-1].extraText+=x,x=""),curDate=e,/\*+/.test(e)&&(excIn=o.length);else if(timeRegex.test(e)&&""!==curDate){let t=e.match(timeRegex),[n,a]=t[1].split("-").map(t=>t.trim()),i="";null!=t[2]&&(i=t[2].replace(/[()]/g,"")),null!=t[3]&&(x+=t[3].trim()),void 0===a&&(a=n),i=null!=tzAbbrs[i]?tzAbbrs[i]:"",o.push({start:[curDate,n].join(" "),end:[curDate,a].join(" "),tz:i,extraText:""})}else""!=x&&(x+="\n\n"),x+=e,t===m.length-1&&(o[o.length-1].extraText+=x);o=o.map(function(t){idesc="";let e=moment.tz(t.start,"ddd, MMM D, YYYY h:mma",t.tz),n=moment.tz(t.end,"ddd, MMM D, YYYY h:mma",t.tz);return n.format()==e.format()&&(n.add(1,"hours"),idesc+="***NO END TIME PROVIDED. FIGURE IT OUT I GUESS.***\n\n"),{start:e,end:n,idesc:idesc+t.extraText}});break;case"LOCATION":case"LOCATIONS":const h=nextUntil(l,"h2","br");for(let[t,e]of[...h].entries())if(shortDateRegex.test(e.textContent.trim())){i=h.slice(0,t).join(" ");let n=getShortDate(e.textContent.trim());null!=n&&(a[n]=nextUntil(e,"br","br",2).map(t=>t.textContent.trim()).join(" "))}for(var c=t,d=l;c++&&(d=n[c])&&c<n.length&&shortDateRegex.test(d.textContent.trim());)locDate=getShortDate(d.textContent.trim()),a[locDate]=nextUntil(d,"h2","br").map(t=>t.textContent.trim()).join(" ");null===i&&(i=h.map(t=>t.textContent.trim()).join(" "));break;case"BREAKDOWN":case"BREAKDOWNS":if(!e.includes(s))break;""!=r&&(r+="\n\n"),r+=s+"\n"+nextUntil(l,"center").map(function(t){return 1===t.nodeType&&t.matches("br")?"\n":t.textContent.trim()}).join(" ");break;default:if(!e.includes(s))break;""!=r&&(r+="\n\n"),r+=s+"\n"+nextUntil(l,"h2").map(function(t){return 1===t.nodeType&&t.matches("br")?"\n":t.textContent.trim()}).join(" ")}}var m=window.location.href;for(date of o){var x=date.start.format("DDD");date.loc=x in a?a[x]:i}if("apple"==t.calendar){if(0===o.length)throw"Grabber doesn't think there are any events listed on this page. ¯\\_(ツ)_/¯";var h=ics();for(date of o)h.addEvent(s,(date.idesc+"\n\n"+r).replace(/(\s*\n\s*){3,}/g,"\n\n").replace(/\n/g,"\\n"),escapeCommas(date.loc),date.start,date.end,m);var f=camelize(s.replace(/[^a-z\s]/gi,"")).slice(0,20)+moment().valueOf();h.download(f)}if("google"==t.calendar){var g=[];for(date of o){var p="https://calendar.google.com/calendar/r/eventedit?trp=False&sf=true&text="+encodeURIComponent(s)+"&ctz="+date.start.tz()+"&dates="+date.start.utc().format("YYYYMMDD[T]HHmmss[Z]")+"/"+date.end.utc().format("YYYYMMDD[T]HHmmss[Z]")+"&details="+encodeURIComponent(date.idesc+"\n\n"+r+"\n\n"+m)+"&location="+encodeURI(date.loc);g.push(p)}for(link of g)window.open(link,"_blank")}}catch(t){m="https://github.com/jacobrienstra/audition_grabber/issues/new?title="+encodeURIComponent(t).replace(/'/g,"%27")+"&body="+encodeURIComponent(window.location.href);launchToast(t,!0,m),console.log(t)}});